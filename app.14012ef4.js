parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"A2T1":[function(require,module,exports) {
function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],o=!0,a=!1,r=void 0;try{for(var c,i=e[Symbol.iterator]();!(o=(c=i.next()).done)&&(n.push(c.value),!t||n.length!==t);o=!0);}catch(s){a=!0,r=s}finally{try{o||null==i.return||i.return()}finally{if(a)throw r}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var nytPageUrl="https://cors-anywhere.herokuapp.com/https://www.nytimes.com/interactive/2020/us/coronavirus-us-cases.html",maxDiffMs=36e5,version="1.2.0";localStorage.version!==version&&(localStorage.clear(),localStorage.version=version);var elements={yourLocation:document.querySelector("#your-location"),confirmed:document.querySelector("#confirmed"),deaths:document.querySelector("#deaths"),locationButton:document.querySelector("#locationButton"),refreshButton:document.querySelector("#refreshButton"),lastDataRequest:document.querySelector("#lastDataRequest"),locationError:document.querySelector("#locationError"),casesError:document.querySelector("#casesError"),active:document.querySelector("#active"),distanceSelect:document.querySelector("#distanceSelect"),locationTableBody:document.querySelector("tbody")};function getData(){var cacheDiff=Date.now()-localStorage.cacheTime;return elements.lastDataRequest.textContent=new Date(+localStorage.cacheTime||Date.now()).toLocaleString(),localStorage.cacheTime&&cacheDiff<maxDiffMs&&localStorage.nytData?Promise.resolve(JSON.parse(localStorage.nytData)):fetch(nytPageUrl).then(function(e){return e.text()}).then(function(html){var page=document.createElement("div");page.innerHTML=html;var link=page.querySelector('link[rel="preload"]'),baseUrl=link.getAttribute("href").match(/https\:\/\/static01\.nyt\.com\/newsgraphics\/2020\/01\/21\/china-coronavirus\/(.*)\/build\/js\/main\.js/),buildId=baseUrl[1],url="https://static01.nyt.com/newsgraphics/2020/01/21/china-coronavirus/".concat(buildId,"/build/js/chunks/model-lite.js");return fetch(url).then(function(e){return e.text()}).then(function(js){js=js.replace(/export {(.*)/,""),eval(js);var data={countries:countries,us_cases:us_cases,us_counties:us_counties},cases={};return cases.us_cases=data.us_counties.map(function(e){var t=e.county_id,n=e.confirmed,o=e.deaths,a=e.lat,r=e.lon,c=e.county,i=e.postal;return{id:t,confirmed:n,deaths:o,latitude:a,longitude:r,name:"".concat(c," ").concat("LA"===i?"Parish":"AK"===i?"Borough":"County",", ").concat(i)}}),cases.world_cases=data.countries.map(function(e){var t=e.nyt_id,n=e.unique;return{id:t,confirmed:e.confirmed,deaths:e.deaths,latitude:e.lat,longitude:e.lon,name:n}}),localStorage.cacheTime=Date.now(),localStorage.nytData=JSON.stringify(cases),cases})})}var firstRun=!0;function getDistances(e){var t=_slicedToArray(e,2),n=t[0],o=t[1],a=n.us_cases.concat(n.world_cases.filter(function(e){return"US"!==e.name})).map(function(e){e.distance_kms=getDistance(o.latitude,o.longitude,e.latitude,e.longitude),e.distance_miles=.6213712*e.distance_kms;var t=document.createElement("tr"),n={distance_miles:"blue",name:"purple",confirmed:"yellow",deaths:"red"};return["distance_miles","name","confirmed","deaths"].forEach(function(o){var a=document.createElement("td");a.textContent="distance_miles"===o?e[o].toFixed(1):"Last_Update"===o?new Date(e[o]).toLocaleString():e[o],a.classList.add(n[o]),t.appendChild(a)}),e.element=t,e});a.sort(function(e,t){return e.distance_kms-t.distance_kms}),firstRun&&(elements.distanceSelect.value=500,firstRun=!1);var r=+elements.distanceSelect.value,c=a.reduce(function(e,t){return t.distance_miles<r&&(Object.keys(e).forEach(function(n){"locations"!==n&&(e[n]+=t[n])}),e.locations.push(t)),e},{confirmed:0,deaths:0,locations:[]});return c.distance_miles=r,{location:o,closest:c}}function getDistance(e,t,n,o){var a=.017453292519943295,r=Math.cos,c=.5-r((n-e)*a)/2+r(e*a)*r(n*a)*(1-r((o-t)*a))/2;return 12742*Math.asin(Math.sqrt(c))}function getIPLocation(){var e=Date.now()-localStorage.cacheTime;return localStorage.cacheTime&&localStorage.cacheLocation&&e<maxDiffMs?Promise.resolve(JSON.parse(localStorage.cacheLocation)):fetch("https://ipapi.co/json/").then(function(e){return e.json()}).then(function(e){return localStorage.cacheLocation=JSON.stringify(e),localStorage.cacheTime=Date.now(),e}).catch(function(e){return delete localStorage.cacheLocation,{city:"Unknown"}})}function getLocationFromCoords(e){var t="".concat(e.latitude,", ").concat(e.longitude);if(localStorage[t])return Promise.resolve(JSON.parse(localStorage[t]));var n="https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e.latitude,"&lon=").concat(e.longitude);return fetch(n).then(function(e){return e.json()}).then(function(n){var o={city:n.address.city||n.address.village,region_code:n.address.state,county:n.address.county,country:n.address.country_code.toUpperCase(),latitude:e.latitude,longitude:e.longitude};return localStorage[t]=JSON.stringify(o),o}).catch(function(){return{city:location,region_code:"",country:"",latitude:e.latitude,longitude:e.longitude}})}function getLocation(e){return"true"===localStorage.useFineLocation||e?new Promise(function(e,t){navigator.geolocation.getCurrentPosition(function(t){localStorage.useFineLocation=!0,elements.locationButton.style.display="none",e(getLocationFromCoords(t.coords))},function(){localStorage.useFineLocation=!1,elements.locationButton.style.display="",e(getIPLocation())},{timeout:1e4})}):getIPLocation()}function setAllCaseInfo(e){elements.confirmed.textContent=e,elements.deaths.textContent=e,elements.lastDataRequest.textContent="Never"}function showInfo(e){var t=e.location,n=e.closest;"Unknown"===t.city?(elements.locationError.style.display="",elements.yourLocation.textContent="Unknown",setAllCaseInfo("Unknown")):n?("US"===t.country?elements.yourLocation.textContent=[t.county||t.city,t.region_code].filter(function(e){return e}).join(", "):elements.yourLocation.textContent=[t.city,t.region_code,t.country].filter(function(e){return e}).join(", "),elements.locationTableBody.innerHTML="",n.locations.forEach(function(e){elements.locationTableBody.appendChild(e.element)}),elements.confirmed.textContent=n.confirmed,elements.deaths.textContent=n.deaths):(elements.yourLocation.textContent=[t.city,t.region_code,t.country].filter(function(e){return e}).join(", "),setAllCaseInfo("Unknown"),elements.casesError.style.display="")}function render(e){elements.locationError.style.display="none",elements.casesError.style.display="none",Promise.all([getData(),getLocation(e)]).then(getDistances).then(showInfo),setTimeout(render,maxDiffMs)}render(!1),elements.locationButton.addEventListener("click",function(){render(!0),elements.locationButton.style.display="none"}),elements.refreshButton.addEventListener("click",function(){delete localStorage.cacheData,delete localStorage.cacheTime,render()}),elements.distanceSelect.addEventListener("input",function(e){render()});
},{}]},{},["A2T1"], null)